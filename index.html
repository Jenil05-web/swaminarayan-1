<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Scan Here for Entry Details</title>
  <!-- Include the QRCode.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // Generate a random token.
    function generateToken() {
      return Math.random().toString(36).substr(2, 9);
    }

    // Generate and display a QR code that expires after 20 seconds.
    function generateAndExpireQRCode() {
      const container = document.getElementById("qrContainer");
      // Clear any previous content.
      container.innerHTML = "";
      
      // Generate a new token and set expiration (20 seconds from now).
      const token = generateToken();
      const expiry = Date.now() + 20000; // 20,000 milliseconds
      
      // Constant base Google Form URL (replace with your desired URL).
      const baseFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSf94jLm-MBSgrAgYRMKn9kPyonZdAB8IrTq-ODmLd0QFYHPug/viewform";
      
      // Create the dynamic URL with token and expiry parameters.
      const dynamicUrl = baseFormUrl + "?token=" + token + "&expiry=" + expiry;
      
      // Generate the QR code in the container.
      new QRCode(container, {
        text: dynamicUrl,
        width: 200,
        height: 200,
        correctLevel: QRCode.CorrectLevel.H
      });
      
      // Display the expiration time on the page.
      document.getElementById("expiryDisplay").innerText =
        "QR code expires at: " + new Date(expiry).toLocaleTimeString();

      console.log("Generated QR code URL:", dynamicUrl);
      
      // After 20 seconds, expire the QR code and show an expiration message.
      setTimeout(function(){
        container.innerHTML = "<p>QR Code expired. Generating new one...</p>";
        // After a short delay, generate a new QR code.
        setTimeout(generateAndExpireQRCode, 1000);
      }, 20000);
    }

    // When the window loads, start generating the QR code.
    window.onload = generateAndExpireQRCode;
  </script>
</head>
<body>
  <h1>Scan Here for Entry Details</h1>
  <div id="qrContainer"></div>
  <p id="expiryDisplay"></p>
</body>
</html>
