<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dynamic One-Time QR Code</title>
  <!-- Include the QRCode.js library from a CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    let currentToken = null;
    
    // Generates a random token (for uniqueness)
    function generateToken() {
      return Math.random().toString(36).substr(2, 9);
    }

    // Generates a new QR code based on the Google Form URL and appends a unique token
    function generateQRCode() {
      const qrContainer = document.getElementById('qrContainer');
      qrContainer.innerHTML = ""; // Clear previous QR code
      
      // Create a new unique token for this QR code
      currentToken = generateToken();
      
      // Append the token as a URL parameter.
      // (This helps simulate that each QR is one-time / unique.)
      const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSf94jLm-MBSgrAgYRMKn9kPyonZdAB8IrTq-ODmLd0QFYHPug/viewform?token=" + currentToken;

      // Generate the QR code with the unique URL
      new QRCode(qrContainer, {
        text: formURL,
        width: 200,
        height: 200,
        correctLevel: QRCode.CorrectLevel.H  // High error correction
      });
      
      // Update the clickable link (anchor) to use the new URL
      document.getElementById('qrLink').href = formURL;
    }

    // Refreshes the QR code: call generateQRCode()
    function refreshQRCode() {
      generateQRCode();
    }

    // Called when a QR code is "scanned" (simulated here by a tap or click)
    function onQRCodeScanned() {
      // "Disable" the current QR code by invalidating the link.
      document.getElementById('qrLink').href = "#disabled";
      
      // Optionally, display a message indicating the code was used.
      document.getElementById('qrContainer').innerHTML = "<p style='font-family: sans-serif;'>QR code scanned. Generating new codeâ€¦</p>";
      
      // After a short delay, generate a new QR code.
      setTimeout(refreshQRCode, 1000);
    }

    window.onload = function() {
      generateQRCode();
      
      // Optional: Auto-refresh the QR code every 10 seconds.
      // Remove the next line if you want to change the code only when scanned.
      setInterval(refreshQRCode, 10000);

      // Add an event listener to simulate scanning.
      // When the container is clicked/tapped, it simulates that the QR was scanned.
      document.getElementById('qrContainer').addEventListener('click', onQRCodeScanned);
    };
  </script>
</head>
<body>
  <h1>Dynamic One-Time QR Code for Google Form</h1>
  <p>The QR code below is generated dynamically and auto-refreshes. When tapped (simulating a scan), the current code is disabled and replaced with a new one.</p>
  
  <!-- The anchor tag makes the QR code clickable. -->
  <a id="qrLink" target="_blank">
    <div id="qrContainer"></div>
  </a>
  
  <!-- Optional manual refresh button -->
  <button onclick="refreshQRCode()">Manual Refresh</button>
  
  <p>Use your mobile device to scan the QR. Each QR code is unique and will be replaced once scanned.</p>
</body>
</html>
