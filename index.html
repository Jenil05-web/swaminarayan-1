<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dynamic One-Time QR Code Display</title>
  <!-- Include the QRCode.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // Function to generate a random token.
    function generateToken() {
      return Math.random().toString(36).substr(2, 9);
    }
    
    // Function to generate the QR code.
    function generateQRCode() {
      const qrContainer = document.getElementById("qrContainer");
      qrContainer.innerHTML = ""; // Clear any previous QR code
      
      const token = generateToken();
      // Set expiry time: 20 seconds from now.
      const expiry = Date.now() + 20000;
      
      // Generate an absolute URL.
      // window.location.origin returns "https://yourusername.github.io"
      // window.location.pathname returns "/repositoryName/" (if hosted as a project page)
      let baseUrl = window.location.origin + window.location.pathname;
      // Make sure the base URL ends with a slash.
      if (!baseUrl.endsWith("/")) {
         baseUrl += "/";
      }
      
      // Create the absolute URL for scan.html.
      const scanURL = baseUrl + "scan.html?token=" + token + "&expiry=" + expiry;
      
      // Optional: Display the expiry time for feedback.
      document.getElementById('expiryDisplay').innerText =
        "Expires at: " + new Date(expiry).toLocaleTimeString();
      
      // Generate the QR code using the absolute URL.
      new QRCode(qrContainer, {
        text: scanURL,
        width: 200,
        height: 200,
        correctLevel: QRCode.CorrectLevel.H
      });
    }
    
    // Generate a fresh QR code on page load and every 20 seconds.
    window.onload = function() {
      generateQRCode();
      setInterval(generateQRCode, 20000);
    };
  </script>
</head>
<body>
  <h1>Dynamic One-Time QR Code Display</h1>
  <p>Scan the QR code with your mobile device to open the Google Form.<br>
  (The QR code is valid for 20 seconds only.)</p>
  <div id="qrContainer"></div>
  <p id="expiryDisplay"></p>
</body>
</html>
